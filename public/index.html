<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LLMFlow</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
    <link rel="stylesheet" href="style.css" />
    <script defer src="app.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-row">
          <div class="header-left">
            <h1 class="logo">
              <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                <path d="M2 17l10 5 10-5"/>
                <path d="M2 12l10 5 10-5"/>
              </svg>
              LLMFlow
              <span id="connectionStatus" class="status-dot" title="Connecting..."></span>
            </h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">
              <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
              </svg>
              <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
              </svg>
            </button>
          </div>
          <div class="stats-bar">
            <div class="stat">
              <span class="stat-value" id="totalRequests">-</span>
              <span class="stat-label">Traces</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="totalTokens">-</span>
              <span class="stat-label">Tokens</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="totalCost">-</span>
              <span class="stat-label">Cost</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="avgLatency">-</span>
              <span class="stat-label">Avg Latency</span>
            </div>
          </div>
        </div>
      </header>

      <main>
        <div class="tabs">
          <button class="tab active" onclick="showTab('timeline')">Timeline</button>
          <button class="tab" onclick="showTab('traces')">Traces</button>
          <button class="tab" onclick="showTab('logs')">Logs</button>
          <button class="tab" onclick="showTab('metrics')">Metrics</button>
          <button class="tab" onclick="showTab('models')">Models</button>
          <button class="tab" onclick="showTab('analytics')">Analytics</button>
        </div>

        <div id="timelineTab" class="tab-content active">
          <div class="filter-bar">
            <input type="text" id="timelineSearchInput" placeholder="Search timeline... (press /)" />
            <select id="toolFilter">
              <option value="">All Tools</option>
              <option value="claude-code">Claude Code</option>
              <option value="codex-cli">Codex CLI</option>
              <option value="gemini-cli">Gemini CLI</option>
              <option value="aider">Aider</option>
              <option value="proxy">Proxy</option>
            </select>
            <select id="timelineTypeFilter">
              <option value="">All Types</option>
              <option value="trace">Traces</option>
              <option value="log">Logs</option>
              <option value="metric">Metrics</option>
            </select>
            <select id="timelineDateFilter">
              <option value="">All Time</option>
              <option value="1h">Last Hour</option>
              <option value="24h">Last 24h</option>
              <option value="7d">Last 7d</option>
            </select>
            <button id="clearTimelineFilters" class="btn-secondary">Clear</button>
          </div>

          <div class="split-layout">
            <div class="panel-left">
              <div id="timelineList" class="timeline-list">
                <div class="empty-state">Loading timeline...</div>
              </div>
            </div>

            <div class="panel-right" id="timelineDetailPanel">
              <div class="detail-header">
                <h2 id="timelineDetailTitle">Select an item</h2>
                <span id="timelineDetailMeta" class="detail-meta"></span>
              </div>
              <div class="detail-body">
                <div class="detail-section" id="timelineDetailContent">
                  <pre id="timelineDetailData">{}</pre>
                </div>
                <div class="detail-section" id="relatedLogsSection" style="display: none;">
                  <h3>Related Logs</h3>
                  <div id="relatedLogs"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="tracesTab" class="tab-content">
          <div class="filter-bar">
            <input type="text" id="searchInput" placeholder="Search... (press /)" />
            <select id="modelFilter">
              <option value="">All Models</option>
            </select>
            <select id="statusFilter">
              <option value="">All Status</option>
              <option value="success">Success</option>
              <option value="error">Error</option>
            </select>
            <select id="dateFilter">
              <option value="">All Time</option>
              <option value="1h">Last Hour</option>
              <option value="24h">Last 24h</option>
              <option value="7d">Last 7d</option>
            </select>
            <button id="clearFilters" class="btn-secondary">Clear</button>
          </div>

          <div class="split-layout">
            <div class="panel-left">
              <table id="tracesTable">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Type</th>
                    <th>Name</th>
                    <th>Model</th>
                    <th>Tokens</th>
                    <th>Cost</th>
                    <th>Latency</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="tracesBody">
                  <tr>
                    <td colspan="8" class="empty-state">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="panel-right" id="detailPanel">
              <div class="detail-header">
                <h2 id="detailTitle">Select a trace</h2>
                <span id="detailMeta" class="detail-meta"></span>
              </div>
              <div class="detail-body">
                <div class="detail-section">
                  <h3>Info</h3>
                  <pre id="traceInfo">{}</pre>
                </div>
                <div class="detail-section">
                  <h3>Spans</h3>
                  <div id="spanTree" class="span-tree">
                    <span class="empty-state">Click a trace to view spans</span>
                  </div>
                </div>
                <div class="detail-section">
                  <h3>Input / Output</h3>
                  <pre id="traceIO">{}</pre>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="logsTab" class="tab-content">
          <div class="filter-bar">
            <input type="text" id="logSearchInput" placeholder="Search logs... (press /)" />
            <select id="logServiceFilter">
              <option value="">All Services</option>
            </select>
            <select id="logEventFilter">
              <option value="">All Events</option>
            </select>
            <select id="logSeverityFilter">
              <option value="">All Severity</option>
              <option value="17">Error+</option>
              <option value="13">Warn+</option>
              <option value="9">Info+</option>
              <option value="5">Debug+</option>
            </select>
            <button id="clearLogFilters" class="btn-secondary">Clear</button>
          </div>

          <div class="split-layout">
            <div class="panel-left">
              <table id="logsTable">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Severity</th>
                    <th>Service</th>
                    <th>Event</th>
                    <th>Body</th>
                  </tr>
                </thead>
                <tbody id="logsBody">
                  <tr>
                    <td colspan="5" class="empty-state">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="panel-right" id="logDetailPanel">
              <div class="detail-header">
                <h2 id="logDetailTitle">Select a log</h2>
                <span id="logDetailMeta" class="detail-meta"></span>
              </div>
              <div class="detail-body">
                <div class="detail-section">
                  <h3>Body</h3>
                  <pre id="logBody">-</pre>
                </div>
                <div class="detail-section">
                  <h3>Attributes</h3>
                  <pre id="logAttributes">{}</pre>
                </div>
                <div class="detail-section">
                  <h3>Resource</h3>
                  <pre id="logResource">{}</pre>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="metricsTab" class="tab-content">
          <div class="filter-bar">
            <select id="metricNameFilter">
              <option value="">All Metrics</option>
            </select>
            <select id="metricServiceFilter">
              <option value="">All Services</option>
            </select>
            <select id="metricTypeFilter">
              <option value="">All Types</option>
              <option value="sum">Sum (Counter)</option>
              <option value="gauge">Gauge</option>
              <option value="histogram">Histogram</option>
            </select>
            <button id="clearMetricFilters" class="btn-secondary">Clear</button>
          </div>

          <div class="metrics-layout">
            <div class="metrics-summary" id="metricsSummary">
              <p class="empty-state">Loading metrics summary...</p>
            </div>

            <div class="metrics-table-container">
              <table id="metricsTable">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Type</th>
                    <th>Name</th>
                    <th>Value</th>
                    <th>Service</th>
                  </tr>
                </thead>
                <tbody id="metricsBody">
                  <tr>
                    <td colspan="5" class="empty-state">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="modelsTab" class="tab-content">
          <div id="modelStats" class="model-grid">
            <p class="empty-state">Loading...</p>
          </div>
        </div>

        <div id="analyticsTab" class="tab-content">
          <div class="analytics-controls">
            <select id="analyticsDaysFilter">
              <option value="7">Last 7 days</option>
              <option value="14">Last 14 days</option>
              <option value="30" selected>Last 30 days</option>
              <option value="90">Last 90 days</option>
            </select>
            <button id="refreshAnalytics" class="btn-secondary">Refresh</button>
          </div>

          <div class="analytics-grid">
            <div class="analytics-card analytics-card-wide">
              <div class="analytics-card-header">
                <h3>Token Usage Trends</h3>
                <span class="analytics-subtitle">Daily token consumption</span>
              </div>
              <div class="analytics-card-body">
                <div id="tokenTrendsChart" class="chart-container">
                  <p class="empty-state">Loading chart...</p>
                </div>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3>Cost by Tool</h3>
                <span class="analytics-subtitle">Total spend per AI tool</span>
              </div>
              <div class="analytics-card-body">
                <div id="costByToolChart" class="chart-container">
                  <p class="empty-state">Loading chart...</p>
                </div>
              </div>
            </div>

            <div class="analytics-card">
              <div class="analytics-card-header">
                <h3>Cost by Model</h3>
                <span class="analytics-subtitle">Total spend per model</span>
              </div>
              <div class="analytics-card-body">
                <div id="costByModelChart" class="chart-container">
                  <p class="empty-state">Loading chart...</p>
                </div>
              </div>
            </div>

            <div class="analytics-card analytics-card-wide">
              <div class="analytics-card-header">
                <h3>Daily Summary</h3>
                <span class="analytics-subtitle">Requests, tokens, and costs per day</span>
              </div>
              <div class="analytics-card-body">
                <div id="dailySummaryTable" class="daily-summary-table">
                  <p class="empty-state">Loading data...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
